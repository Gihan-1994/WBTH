generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                    String                 @id @default(uuid())
  name                  String
  email                 String                 @unique
  password_hash         String
  contact_no            String?
  role                  UserRole               @default(tourist)
  created_at            DateTime               @default(now()) @map("created_at")
  accommodationProvider AccommodationProvider?
  admin                 Admin?
  bookings              Booking[]
  guide                 Guide?
  notifications         Notification[]
  paymentsReceived      Payment[]              @relation("ReceiverPayments")
  paymentsSent          Payment[]              @relation("SenderPayments")
  tourist               Tourist?

  @@map("users")
}

model Tourist {
  user_id String    @id
  country String?
  dob     DateTime?
  user    User      @relation(fields: [user_id], references: [id])

  @@map("tourists")
}

model Guide {
  user_id         String    @id
  experience      String[]
  languages       String[]
  expertise       String[]
  rating          Float?
  account_no      String?
  price           Float?
  availability    Boolean   @default(true)
  profile_picture String?   @db.Text
  city            String?
  province        String?
  user            User      @relation(fields: [user_id], references: [id])
  bookings        Booking[]

  @@map("guides")
}

model AccommodationProvider {
  user_id        String          @id
  provider_id    String          @unique @default(uuid())
  company_name   String
  logo           String?         @db.Text
  user           User            @relation(fields: [user_id], references: [id])
  accommodations Accommodation[]

  @@map("accommodation_providers")
}

model Accommodation {
  id                String                @id @default(uuid())
  provider_id       String
  name              String
  type              String[]
  amenities         String[]
  rating            Float?
  account_no        String?
  budget            String[]
  location          String
  price_range_min   Float?
  price_range_max   Float?
  province          String?
  interests         String[]
  images            String[]
  group_size        Int?
  num_booking_dates Int?
  prior_bookings    Int?
  provider          AccommodationProvider @relation(fields: [provider_id], references: [provider_id])
  bookings          Booking[]

  @@map("accommodations")
}

model Booking {
  id               String         @id @default(uuid())
  user_id          String
  type             BookingType
  start_date       DateTime       @map("start_date")
  end_date         DateTime       @map("end_date")
  location         String?
  price            Float
  status           BookingStatus  @default(pending)
  description      String[]
  accommodation_id String?
  accommodation    Accommodation? @relation(fields: [accommodation_id], references: [id])
  guide_id         String?
  guide            Guide?         @relation(fields: [guide_id], references: [user_id])
  user             User           @relation(fields: [user_id], references: [id])
  payments         Payment[]

  @@map("bookings")
}

model Rating {
  id          String @id @default(uuid())
  provider_id String
  rating      Int

  @@map("ratings")
}

model Event {
  id          String   @id @default(uuid())
  category    String
  date        DateTime
  location    String
  description String[]

  @@map("events")
}

model Payment {
  id          String  @id @default(uuid())
  receiver_id String
  sender_id   String
  booking_id  String
  amount      Float
  status      String
  booking     Booking @relation(fields: [booking_id], references: [id])
  receiver    User    @relation("ReceiverPayments", fields: [receiver_id], references: [id])
  sender      User    @relation("SenderPayments", fields: [sender_id], references: [id])

  @@map("payments")
}

model Notification {
  id         String   @id @default(uuid())
  user_id    String
  type       String
  message    String[]
  created_at DateTime @default(now()) @map("created_at")
  user       User     @relation(fields: [user_id], references: [id])

  @@map("notifications")
}

model Admin {
  id            String @id @default(uuid())
  user_id       String @unique
  email         String @unique
  password_hash String
  user          User   @relation(fields: [user_id], references: [id])

  @@map("admins")
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
  @@map("verification_tokens")
}

enum UserRole {
  tourist
  guide
  accommodation_provider
  admin
}

enum BookingType {
  accommodation
  guide
}

enum BookingStatus {
  pending
  confirmed
  cancelled
}
